<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>AlgoTransparency</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <meta property="og:url" content="http://algotransparency.org/" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="YouTube's Recommendations" />
    <meta property="og:image" content="https://algotransparency.org/images/youtube-map-mini.jpg" />
    <meta property="og:image:type" content="image/jpg" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>                       
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>-->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--
      <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script> -->

    <!--  jQuery -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

    <!-- Isolated Version of Bootstrap, not needed if your site already uses Bootstrap -->
    <link rel="stylesheet" href="//formden.com/static/cdn/bootstrap-iso.css" />

    <!-- Bootstrap Date-Picker Plugin -->
    <script type="text/javascript"
        src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet"
        href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />

    <link href="//fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
    <link rel="stylesheet" href="/app.css">
    <link rel="stylesheet" href="/modifications.css">
    <script src="/app.js"></script>
    <script>
        require('initialize-info');
    </script>

    <script type="text/javascript">
        (function (e, t) {
            var n = e.amplitude || { _q: [], _iq: {} }; var r = t.createElement("script")
                ; r.type = "text/javascript"; r.async = true
                ; r.src = "https://cdn.amplitude.com/libs/amplitude-4.1.0-min.gz.js"
                ; r.onload = function () {
                    if (e.amplitude.runQueuedFunctions) {
                        e.amplitude.runQueuedFunctions()
                    } else {
                        console.log("[Amplitude] Error: could not load SDK")
                    }
                }
                ; var i = t.getElementsByTagName("script")[0]; i.parentNode.insertBefore(r, i)
                ; function s(e, t) {
                    e.prototype[t] = function () {
                        this._q.push([t].concat(Array.prototype.slice.call(arguments, 0))); return this
                    }
                }
            var o = function () { this._q = []; return this }
                ; var a = ["add", "append", "clearAll", "prepend", "set", "setOnce", "unset"]
                ; for (var u = 0; u < a.length; u++) { s(o, a[u]) } n.Identify = o; var c = function () {
                    this._q = []
                        ; return this
                }
                ; var l = ["setProductId", "setQuantity", "setPrice", "setRevenueType", "setEventProperties"]
                ; for (var p = 0; p < l.length; p++) { s(c, l[p]) } n.Revenue = c
                ; var d = ["init", "logEvent", "logRevenue", "setUserId", "setUserProperties", "setOptOut", "setVersionName", "setDomain", "setDeviceId", "setGlobalUserProperties", "identify", "clearUserProperties", "setGroup", "logRevenueV2", "regenerateDeviceId", "logEventWithTimestamp", "logEventWithGroups", "setSessionId"]
                ; function v(e) {
                    function t(t) {
                        e[t] = function () {
                            e._q.push([t].concat(Array.prototype.slice.call(arguments, 0)))
                        }
                    }
                    for (var n = 0; n < d.length; n++) { t(d[n]) }
                } v(n); n.getInstance = function (e) {
                    e = (!e || e.length === 0 ? "$default_instance" : e).toLowerCase()
                        ; if (!n._iq.hasOwnProperty(e)) { n._iq[e] = { _q: [] }; v(n._iq[e]) } return n._iq[e]
                }
                ; e.amplitude = n
        })(window, document);

        amplitude.getInstance().init("ac83dc709767bb0f32724a7edff4e715");
        amplitude.getInstance().logEvent('Index Loaded');
    </script>
</head>

<body>
    <section class="hero is-small">
        <!-- Hero header: will stick at the top -->
        <div class="hero-head">
            <header class="nav nav-first">
                <div class="nav-bar">
                    <div class="nav-left">
                        <a class="nav-item" href="index.html">
                            <strong>AlgoTransparency</strong>
                        </a>
                    </div>
                    <span class="nav-toggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                    <div class="nav-right nav-menu">
                        <!-- <a class="nav-item" href="/en/hongkong.html">
                            Hong Kong Protests
                        </a> -->
                        <a class="nav-item" href="/youtube.html">
                            YouTube Map
                        </a>
                        <a class="nav-item" href="/en/science.html">
                            Themes
                        </a>
                        <a class="nav-item" href="/verbs.html">
                            Top 25 Verbs
                        </a>
                        <a class="nav-item" href="/methodology.html">
                            About
                        </a>
                        <a class="nav-item" href="/en/press.html">
                            Media
                        </a>
                        <div class="twitter-btn">
                            <a href="https://twitter.com/aiTransparency?ref_src=twsrc%5Etfw" class="twitter-follow-button"
                                data-size="large" data-show-screen-name="false" data-lang="en"
                                data-show-count="false">Follow @aiTransparency</a>
                            <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                        </div>
                    </div>
                </div>
            </header>
            <div class="search-space">
                <div class="container column is-8 is-offset-2">
                    <div class="info-title">
                        <div class="info-title-in col-xs-12">
                            AlgoTransparency
                        </div>
                        <div class="info-title-sub col-xs-12">
                            Artificial Intelligence (AI) controls what information you are shown on social media.
                            What does it want you to see?
                        </div>
                    </div>
                    <div style="margin-bottom:40px;">
                        <!-- <div class="col-xs-6">
                            <div class="input-group">
                                <div>
                                    <label for="srch-term">FILTER TITLES / CHANNELS</label>
                                    <input type="text" class="form-control straight-box" placeholder='Enter a keyword'
                                        name="srch-term" id="srch-term">
                                </div>
                            </div>
                        </div> -->
                        <div class="col-xs-3">
                            <div class='input-group date' id='datetimepicker1'>
                                <label class="control-label" for="date">DATE</label>
                                <input class="form-control noradius" id="date" name="date" placeholder="MM/DD/YYY"
                                    type="text" data-date-end-date="0d" />

                                <!-- <label for="date-picker">DATE</label>
                                                            <input type='text' class="form-control" id="date-picker"/>
                                                            <div class="input-group-addon">
                                                                  <span class="glyphicon glyphicon-calendar"></span>
                                                            </div> -->
                            </div>
                        </div>
                        <div style="display:inline-block">
                            <button class="btn search-btn btn-danger btn-gg" style="padding-left:10px"
                                onclick="gotoGoogle()">
                                <span style="color:#4285F4">G</span><span style="color:#DB4437">o</span><span
                                    style="color:#F4B400">o<span style="color:#4285F4">g</span><span
                                        style="color:#0F9D58">l</span><span style="color:#DB4437">e</span>
                            </button>
                        </div>
                        <div style="display:inline-block">
                            <button class="btn search-btn btn-danger btn-yt" style="padding-left:10px"
                                onclick="gotoYouTube()">YouTube</button>
                        </div>
                        <div style="display:inline-block">
                            <button class="btn search-btn btn-danger btn-fb" style="padding-left:10px"
                                onclick="gotoFacebook()">Facebook</button>
                        </div>
                        <div style="display:inline-block">
                            <button class="btn search-btn btn-danger btn-tw" style="padding-left:10px"
                                onclick="gotoTwitter()">Twitter</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="section columns">
        <div class="container column is-8 is-offset-2">
            <div id="twitter"
                style="display: none;margin:40px;max-width:600px;font-weight:500;font-size:16px !important">
                <a href="https://www.oberlo.com/blog/twitter-statistics">330 Million people</a> turn to Twitter as a source of information.<br><br>

                Among these are many of the world's most prominent journalists, academics and politicians; amplifying
                the platform's influence.<br><br>

                Every day, Artificial Intelligence decides which hashtags and topics make it to Twitter
                Trending.<br><br>

                Some trends have a lot of mentions, while others do not.<br>
                Some are amplified by bots, who trick the AI into thinking these must be trending.<br><br>

                We monitor twitter trending daily.
                <div id="twitter-data"></div>
            </div>
            <div id="google"
                style="display: none;margin:40px;max-width:600px;font-weight:500;font-size:16px !important">
                <a href="https://www.google.com/search?q=how%20many%20searches%20are%20made%20on%20google%20daily">3.5 Billion searches</a> are done on Google daily.<br><br>

                Google's auto-complete influences what people search, and therefore the results that they see. It's one
                of the most impactful AIs of the world. <br><br>

                What does it recommend? We monitor this daily. <br><br>
                <div id="google-data"></div>
            </div>
            <div id="facebook"
                style="display: none;margin:40px;max-width:600px;font-weight:500;font-size:16px !important">
                <a syle="color:red"> 2.7 Billion people</a> use Facebook every month.<br><br>

                What information is the most shared on different topics right now? To answer these questions, we created CrowdTangle dashboards. Each dashboard monitors a set of keywords, in a given language.

                Here is how to read them:<br><br>
                <a href="https://apps.crowdtangle.com/transparency/boards/us2020election"><img src="/images/ct.png"
                    style="max-width: 900px;" /></a>
                <br><br>
                Available dashboards:<br><br>

                <h2><a href="https://apps.crowdtangle.com/transparency/boards/englishpoliticalcontent">English Political Facebook</a></h2>
                <div class="ct-desc">This dashboard contains public posts that contain one of these keywords: government, president, politics, political, left-wing, right-wing, democracy, democratic, liberal, conservative, policy, policies, state, senate, cabinet, chancellor, prime minister, minister, parliamentary, parliament</div>

                <h2><a href="https://apps.crowdtangle.com/transparency/boards/electionglobalenglishcontent">Election</a></h2>
                <div class="ct-desc">This dashboard contains public posts that contains the keyword "election"
                </div>

                <h2><a href="https://apps.crowdtangle.com/workspace/boards/covid-19englishcontent">Covid</a></h2>
                <div class="ct-desc">This dashboard contains public posts that contains the keyword "covid"
                </div>

                <h2><a href="https://apps.crowdtangle.com/transparency/boards/immigrantsimmigration">Immigration</a></h2>
                <div class="ct-desc">This dashboard contains public posts that contains the keywords "immigrant", "immigrants", or "Immigration"
                </div>

                <h2><a href="https://apps.crowdtangle.com/transparency/boards/5g">5G</a></h2>
                <div class="ct-desc">This dashboard contains public posts that contains the keyword "5G"
                </div>

                <h2><a href="https://apps.crowdtangle.com/transparency/boards/civilwar">Civil War</a></h2>
                <div class="ct-desc">Context: there have been calls for civil war in the US, and fears of civil war in some information ecosystems.<br>
                This dashboard contains public posts that contains the keyword "Civil War".
                </div>

                <h2><a href="https://apps.crowdtangle.com/protestsafety/boards/blacklivesmatter?fbclid=IwAR1q3m4aRYqeaQ6r8ESwUZBSbllHD_1dcJPg9NMewzbmhZQp-Q7G-H8D_e0">BLM</a></h2>
                <div class="ct-desc">This dashboard was created by the CrowdTangle team at Facebook, and monitors BLM on Facebook and Instagram</div>
 
                <h2><a href="https://apps.crowdtangle.com/transparency/boards/frenchpoliticalcontent">French Political Facebook</a></h2>
                <div class="ct-desc">This dashboard contains public posts that contain one of these keywords: gouvernement, président, politique, démocratie, démocratique, libérale, libéral, conservatrice, conservateur, conservatrices, politique, stratégies, etat, états, sénat, cabinet, ministère, sénateur, sénatrice, chancelière, chancelier, ministre, parlement, parlementaire</div>

                <h2><a href="https://apps.crowdtangle.com/transparency/boards/spanishpoliticalcontent">Spanish Political Facebook</a></h2>
                <div class="ct-desc">This dashboard contains public posts that contain one of these keywords: gobierno, presidenta, presidente, política, democracia, democrática, democrático, liberal, conservadora, conservador, conservadoras, politicas, estado, estados, senado, ministros, senadora, senador, canciller, ministra, ministro, parlamentaria, parlamentario, parlamento</div>

                <h2><a href="https://apps.crowdtangle.com/transparency/boards/polishpoliticalcontent">Polish Political Facebook</a></h2>
                <div class="ct-desc">This dashboard contains public posts that contain one of these keywords: rząd, władze, gabinet, przywódcy, prezydent, polityka, demokracja, demokratyczny, liberal, liberalny, konserwatywny, zachowawczy, polityka, polisa, zasady, państwo, rządowy, senat, gabinet, senatorów, kanclerz, posel, premier, parliamentary, poselski, parlament</div>

                <h2><a href="https://apps.crowdtangle.com/transparency/boards/germanpoliticalcontent">German Political Facebook</a></h2>
                <div class="ct-desc">This dashboard contains public posts that contain one of these keywords: regierung, staatsmann, politikern, präsidentin, präsident, vorsitzende, politik, politisch, demokratie, demokratisch, liberale, konservativ, richtlinien, staat, staaten, senate, kabinett, kanzler, kanzlerin, minister, ministerin, parlamentarisch, parlament, volksvertretung</div>

                <strong>Acknowledgements<strong><br><br>


                <strong>These live displays were created with CrowdTangle, a public insights tool owned and operated by Facebook. We'd like to give credit and thanks to Facebook, for making CrowdTangle available to journalists and researchers. It is an important step in the direction of transparency.</strong>            </div>
            <div id="youtube" style="font-size:16px;font-weight:500;margin:40px;">
                <span style="max-width:600px">
                    <a href="https://www.youtube.com/about/press/">2 billion people</a> use YouTube monthly.
                    YouTube’s recommendation algorithm determines what people watch for more than 70% of the views. That's
                    700 million hours - or 1,000 human lifetimes - every single day.<br><br>
                    We monitor <a href="/methodology.html">800+ top information channels</a>, including news channels,
                    vlogers, and shows from across the political spectrum. Details on how we collect this data are available <a href="/methodology.html">here</a><br><br>
                </span>
                <div id="channelstats-title">
                </div>
                <div id="channelstats">
                </div>
                <div id="videostats-title">
                </div>
                <div class="sink-wrapper sink-videos">
                </div>
            </div>
        </div>
        <div class="box-wrapper presentation mb1" id="presentation"></div>
        </div>
    </section>
    <section class="section columns" style="padding-bottom:50px">
        <div class="container column is-6 is-offset-2">
            <!-- <header class="box-wrapper video-header">
                        <div class="box-title">Top 100 videos</div>
                        <span class="float-right">
                              <span class="video-date" id="video__date">
                                    <span id="nb_video"></span> videos collected on</span>
                              <span class="select is-small">
                                    <select id="video-select">
                                          <option value="ytrecos-science-2018-08-01">1st of August 2018</option>
                                    </select>
                              </span>
                        </span>
                  </header> -->
            <!-- <div class="box-wrapper videos">
                  </div> -->
        </div>
        <!-- <div class="container column is-2">
                  <!--<section class="sidebar-right">
            <strong class="is-block">Représentation des candidats</strong>
               <small>dans les titres de vidéos mentionant un candidat</small>
         </section>-->
        <!-- <section class="box-wrapper sidebar-right box-wrapper mb1">
                        <div class="box-title mb2">Frequent terms mentioned in the titles of these videos:</div>
                        <div id="representation"></div>
                  </section> -->
        <!-- <section class="box-wrapper mb1">
                        <div class="box-title mb2">Our project</div>
                        <p class="mb1">AlgoTransparency is designed to inform citizens on the algorithms shaping access to information.
                              <a href="/en/demarche.html">Find out more</a>
                        </p>
                        <div class="mb2">
                              <span class="small">
                                    <div class="twitter-btn-2">
                                          <a href="https://twitter.com/helloalgo?ref_src=twsrc%5Etfw" class="twitter-follow-button"
                                                data-size="large" data-show-screen-name="false" data-lang="en" data-show-count="false">Follow @helloalgo</a>
                                          <script async src="https://platform.twitter.com/widgets.js"
                                                charset="utf-8"></script>
                                    </div>
                              </span>
                              <!-- <div class="addthis_inline_follow_toolbox"></div> -->
        <!-- </div>
                        <small>Developed with help from
                              <a href="http://www.dataforgood.fr/">Data for Good</a>
                        </small> -->
        <!-- </section> -->
        <!-- </div> -->
        <section class="is-2 column"></section>
    </section>
    <!-- <section id="intro" style="display:none">
        <div class="slides-container has-text-centered">
            <button class="btn btn__absolute btn__next btn--highlighted">Next</button>
            <section class="pagination"> </section>
            <section class="slide slide-1">
                <h1 class="mt4">On YouTube, there are</h1>
                <h1 class="mt4"></h1>
                <h1 class="mt4"></h1>
                <img class="slide-image image-small mb2" style="max-width: 500px;margin: 0 auto;"
                    src="/images/youtube-stats.png" alt="">
            </section>
            <section class="slide slide-2">
                <h1>YouTube’s recommendation algorithm</h1>
                <h1>generates more than <span class="redbold">70%</span> of views</h1>
                <h1> &nbsp; </h1>
                <h1> &nbsp; </h1>
                <h1> &nbsp; </h1>
                <h1> &nbsp; </h1>
                <h1> &nbsp; </h1>
                <h2 class="">That's <span class="redbold">700, 000, 000</span> human hours, every single day.</h2>
            </section>
            <section class="slide slide-3">
                <h1 class="">But what did YouTube recommend?</h1>
                <h2 class="mb4">Today, it’s impossible to tell</h2>
                <img class="slide-image image-large" src="/images/slide-3.jpg" alt="">
            </section>
            <section class="slide slide-4">
                <h1 class="">To find out, we created a robot</h1>
                <h2 class="mb4">Every day, it starts from 1000 channels, follows recommendations, and save videos</h2>
                <img class="slide-image image-large pt4" src="/images/slide-4-uk.gif" alt="">
                <h2 class="mb4">What videos were recommended by the algorithm?</h2>
            </section>
        </div>
    </section> -->

    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-58ea64fc4724e90a"></script>

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-97331997-1', 'auto');
        ga('send', 'pageview');

        function getUrlVar(key) {
            const result = new RegExp(key + '=([^&]*)', 'i').exec(window.location.search);
            return (result && unescape(result[1])) || '';
        }

        function changeUrlParam(param, value) {
            const currentURL = window.location.href + '&';
            const change = new RegExp('(' + param + ')=(.*)&', 'g');
            const newURL = currentURL.replace(change, '$1=' + value + '&');

            if (getURLParameter(param) !== null) {
                try {
                    window.history.replaceState('', '', newURL.slice(0, -1));
                } catch (err) {
                    console.err(err);
                }
            } else {
                const currURL = window.location.href;
                if (currURL.indexOf('?') !== -1) {
                    window.history.replaceState(
                        '',
                        '',
                        currentURL.slice(0, -1) + '&' + param + '=' + value
                    );
                } else {
                    window.history.replaceState(
                        '',
                        '',
                        currentURL.slice(0, -1) + '?' + param + '=' + value
                    );
                }
            }
        }

        function getURLParameter(name) {
            return (
                decodeURIComponent(
                    (new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(
                        location.search
                    ) || [, ''])[1]
                        .replace(/\+/g, '%20')
                ) || null
            );
        }
        function create_bar_chart(container_id, title, subtitle, legend, values) {
            console.log(legend);
            console.log(values);

            $('#channelstats').html('')
            $('#channelstats').append(`<div id="${container_id}" style="height: 800px; min-width: 310px; max-width: 1400px; margin: 0 auto"></div>`)

            Highcharts.chart(container_id, {
                chart: {
                    type: 'bar'
                },
                title: {
                    text: title
                },
                subtitle: {
                    text: subtitle
                },

                xAxis: {
                    categories: legend,
                    title: {
                        text: null
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'Legend',
                        align: 'high'
                    },
                    labels: {
                        overflow: 'justify'
                    }
                },
                tooltip: {
                    valueSuffix: ''
                },
                plotOptions: {
                    bar: {
                        dataLabels: {
                            enabled: true
                        }
                    }
                },
                legend: {
                    enabled: false
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: title,
                    data: values
                }]
            });
        }

        let jsonLocal = {};
        let videoData = {};
        let channelData = {};
        let platform = 'youtube'
        const jsonThemeLocal = {};
        var date_us = '';
        var keyword = '';
        var autocompleteData = '';
        var twitterData = null;
        var totalVideosRecommended = null;
        var totalRecommendations = null;

        function gotoTwitter() {
            console.log('Goto Twitter')
            changeUrlParam('platform', 'twitter')
            updateDate();
        }

        function gotoGoogle() {
            console.log('Goto Google')
            changeUrlParam('platform', 'google')
            updateDate();
        }

        function gotoFacebook() {
            console.log('Goto Facebook')
            changeUrlParam('platform', 'facebook')
            updateDate()
        }

        function gotoYouTube() {
            console.log('Goto YouTube')
            changeUrlParam('platform', 'youtube')
            updateDate()
        }

        function updateDate() {
            console.log('update date')
            platform = getURLParameter('platform')
            if (platform === null || platform === 'null') {
                platform = 'youtube'
            }

            if ($('#date').val() == '') {
                if (getUrlVar('date') && getUrlVar('date') != '') {
                    var french_format = getUrlVar('date')
                    $('#date').val(french_format[3] + french_format[4] + '/' + french_format[0] + french_format[1] + '/20' + french_format[8] + french_format[9])
                } else {
                    console.log(' New date ')
                    var today = new Date();

                    // Here we can put -1 if we want.
                    today.setDate(today.getDate());
                    console.log('Today is ' + today.getDay())
                    if (today.getDay() == 7 && today.getMonth() + 1 == 4 && today.getFullYear() == 2019) {
                        today.setDate(today.getDate() - 1);
                    }

                    var dd = today.getDate();
                    var mm = today.getMonth() + 1; //January is 0!
                    var yyyy = today.getFullYear();

                    if (dd < 10) {
                        dd = '0' + dd
                    }

                    if (mm < 10) {
                        mm = '0' + mm
                    }

                    var today_us = mm + '/' + dd + '/' + yyyy;
                    $('#date').val(today_us)
                }
            }

            var d = $('#date').val();
            var filedate = d[3] + d[4] + '-' + d[0] + d[1] + '-' + d[6] + d[7] + d[8] + d[9];
            var date_info = d[6] + d[7] + d[8] + d[9] + '-' + d[0] + d[1] + '-' + d[3] + d[4];
            const lastDate = filedate;
            console.log('Date =');
            console.log(lastDate);

            let url = lastDate; //  getUrlVar('file') ||
            // if (getUrlVar('file')) {
            // $('#video-select').children().each(function() {
            //       if ($(this)[0].value === getUrlVar('file')) $(this)[0].selected = true;
            // });
            // }

            console.log('date tried ' + filedate)

            if (platform === 'youtube') {
                $.get('/data/info/us-info-' + filedate + '-chans.json', function (data) {
                    console.log('We call create bar chart 1.0');
                    create_bar_chart('conta', 'Percentage of recommendations for each channel', '', data['names'], data['percent_recos']);
                });
                $.get('/data/info/us-info-' + filedate + '.json', function (data) {
                    console.log('GOT DATA from file ' + url);
                    jsonLocal = data;
                    let count = 0;
                    console.log('Computing Number of videos ')
                    let videoKey = 'info_channels';
                    count = jsonLocal[videoKey].length;
                    console.log('Number of videos ' + count);
                    videoData = jsonLocal[videoKey];
                    try {
                        totalVideosRecommended = jsonLocal['total_videos_recommended'];
                        totalRecommendations = jsonLocal['total_recommendations'];
                    } catch {
                        console.log('No total videos found')
                    }
                    $('#nb_video').append(count);
                    changeUrlParam('date', url);
                    appendSinkHoles();
                }).fail(function () {
                    var the_date = getURLParameter(date);
                    $('#channelstats-title').html(
                        `
                        <div class="sinkhole">No data available for this date. Please select a different date.<div>
                    `)
                    $('.sink-videos').html('');
                    $('#videostats-title').html('');
                    $('#presentation').css('opacity', 0);
                    $('.sink-videos').css('padding-bottom', '800px');
                });
            } else if (platform === "twitter") {
                console.log('Getting twitter data');
                $.get('/data/twitter/ttrends-' + date_info + '.json', function (data) {
                    twitterData = data;
                    appendSinkHoles()
                })
            } else if (platform === "google") {
                $.get('/data/autocomplete/google-' + date_info + '.json', function (data) {
                    googleData = data;
                    appendSinkHoles()
                })
            } else {
                appendSinkHoles()
            }
        }

        function number_format(number, decimals, dec_point, thousands_sep) {
            // http://kevin.vanzonneveld.net
            // +   original by: Jonas Raoni Soares Silva (http://www.jsfromhell.com)
            // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
            // +     bugfix by: Michael White (http://getsprink.com)
            // +     bugfix by: Benjamin Lupton
            // +     bugfix by: Allan Jensen (http://www.winternet.no)
            // +    revised by: Jonas Raoni Soares Silva (http://www.jsfromhell.com)
            // +     bugfix by: Howard Yeend
            // +    revised by: Luke Smith (http://lucassmith.name)
            // +     bugfix by: Diogo Resende
            // +     bugfix by: Rival
            // +      input by: Kheang Hok Chin (http://www.distantia.ca/)
            // +   improved by: davook
            // +   improved by: Brett Zamir (http://brett-zamir.me)
            // +      input by: Jay Klehr
            // +   improved by: Brett Zamir (http://brett-zamir.me)
            // +      input by: Amir Habibi (http://www.residence-mixte.com/)
            // +     bugfix by: Brett Zamir (http://brett-zamir.me)
            // +   improved by: Theriault
            // +   improved by: Drew Noakes
            // *     example 1: number_format(1234.56);
            // *     returns 1: '1,235'
            // *     example 2: number_format(1234.56, 2, ',', ' ');
            // *     returns 2: '1 234,56'
            // *     example 3: number_format(1234.5678, 2, '.', '');
            // *     returns 3: '1234.57'
            // *     example 4: number_format(67, 2, ',', '.');
            // *     returns 4: '67,00'
            // *     example 5: number_format(1000);
            // *     returns 5: '1,000'
            // *     example 6: number_format(67.311, 2);
            // *     returns 6: '67.31'
            // *     example 7: number_format(1000.55, 1);
            // *     returns 7: '1,000.6'
            // *     example 8: number_format(67000, 5, ',', '.');
            // *     returns 8: '67.000,00000'
            // *     example 9: number_format(0.9, 0);
            // *     returns 9: '1'
            // *    example 10: number_format('1.20', 2);
            // *    returns 10: '1.20'
            // *    example 11: number_format('1.20', 4);
            // *    returns 11: '1.2000'
            // *    example 12: number_format('1.2000', 3);
            // *    returns 12: '1.200'
            var n = !isFinite(+number) ? 0 : +number,
                prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
                sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
                dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
                toFixedFix = function (n, prec) {
                    // Fix for IE parseFloat(0.55).toFixed(0) = 0;
                    var k = Math.pow(10, prec);
                    return Math.round(n * k) / k;
                },
                s = (prec ? toFixedFix(n, prec) : Math.round(n)).toString().split('.');
            if (s[0].length > 3) {
                s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
            }
            if ((s[1] || '').length < prec) {
                s[1] = s[1] || '';
                s[1] += new Array(prec - s[1].length + 1).join('0');
            }
            return s.join(dec);
        }

        function print_item(id) {
            console.log('https://www.youtube.com/watch?v=' + id)
        }

        function appendSinkHoles() {
            $('#panel-block-all').addClass('is-active');
            $('.sink-videos').empty()
            $('#presentation').hide()
            $('.video-header').hide()
            $('.videos').hide()

            // var keyword = $("#srch-term").val()
            // changeUrlParam('keyword', keyword);

            // console.log(keyword)

            $('#facebook').hide()
            $('#youtube').hide()
            $('#google').hide()
            $('#twitter').hide()

            if (platform === "facebook") {
                appendFacebook()
            }
            if (platform === "youtube") {
                appendYouTube();
            }
            if (platform === "twitter") {
                appendTwitter();
            }
            if (platform === "google") {
                console.log('Platform is google, appending google')
                appendGoogle();
            }

            console.log('Platform ' + platform)
        }

        function appendFacebook() {
            $('#facebook').show();
        }

        function appendTwitter() {
            $('#twitter').show();
            $('#twitter-data').html('');
            htm = '<div style="font-weight:bold;font-size:23px;margin-top:25px"> Trending topics on Twitter on<span class="redbold"> ' + $('#date').val() + '</span>:</div>'
            console.log(twitterData)
            for (const [place, trendsContainer] of Object.entries(twitterData)) {
                if (trendsContainer.length > 0) {
                    trends = trendsContainer[0]['trends']
                    htm += `<h2 style="margin-top:25px">${place}</h2>`
                    var nb = 0
                    for (const trend of trends) {
                        nb += 1
                        var volume = ''
                        if (trend.tweet_volume && trend.tweet_volume != 'null') {
                            volume = `<span style="font-size:14px"> ${trend.tweet_volume} tweets</span>`
                        }
                        console.log(trend.tweet_volume)
                        htm += `<div style="font-size:16px;margin-left:100px;"><a href="${trend.url}" onclick="window.open(this.href);return false" style="font-weight:bold">${nb}) ${trend.name}</a> ${volume}</div>`
                    }
                }
            }
            $('#twitter-data').html(htm);
        }

        function appendGoogle() {
            $('#google').show();
            $('#google-data').html('');
            console.log(googleData)
            htm = '<div style="font-weight:bold;font-size:23px;margin-top:25px"> Google autocomplete suggestions on<span class="redbold"> ' + $('#date').val() + '</span>:</div>'
            console.log('KEYS: ')

            console.log(Object.keys(googleData))

            for (const [place, searchTerms] of Object.entries(googleData)) {
                // htm += `<h1 style="margin-top:25px">${place}</h1>`
                    for (const [searchTerm, autocompletes] of Object.entries(searchTerms)) {
                        htm += `<div style="font-weight:bold;font-size:22px;margin-left:50px;">${searchTerm}</div>`
                        for (const completion of autocompletes) {
                            htm += `<div style="font-weight:normal;font-size:16px;margin-left:100px;"><a href="https://www.google.com/search?q=${completion}" onclick="window.open(this.href);return false">${completion}</a></div>`
                        }
                        if (autocompletes.length === 0) {
                            htm += `<div style="font-weight:normal;font-size:16px;margin-left:100px;">[Google blocked autocompletes for this search]</div>`
                        }
                    }
                    htm += `<br><br>`
            }

            console.log(htm)
            $('#google-data').html(htm);
        }

        function appendYouTube() {
            $('#youtube').show();

            if (keyword !== '') {
                $('.info-title').css('max-height', '0px')
            }

            $('.video-header').show()
            $('.videos').show()

            // Compute the sinkholes
            var counts = {}
            var videos_info = {}
            // check if the property/key is defined in the object itself, not in parent
            videoData.filter((item) => item.likes !== -1).forEach((item, index) => {
                counts[item.id] = (counts[item.id] || 0) + 1;
                videos_info[item.id] = item
            })
            var sorted_counts = Object.keys(counts).map(function (key) {
                return [key, counts[key]];
            });

            // Sort the array based on the second element
            sorted_counts.sort(function (first, second) {
                return second[1] - first[1];
            });

            var filtered_vids = videoData.filter((item) => item.likes !== -1).filter((item) =>
                ((item.title || '').toLowerCase().indexOf(keyword.toLowerCase()) > -1) ||
                (item.channel.toLowerCase().indexOf(keyword.toLowerCase()) > -1)).map(function (item) {
                    return [item.id, 0];
                })

            var extra_text = ''
            if (keyword !== '') {
                extra_text = '&nbsp;including<span class="redbold">&nbsp;"' + keyword + '"</span>&nbsp;in its title or channel';
            }

            console.log('Filtered videos:')
            console.log(filtered_vids)

            if ((filtered_vids === null) || (filtered_vids.length === 0)) {
                $('#channelstats-title').html(
                    `
                        <div class="sinkhole">No data available for that date and search parameters.<div>
                    `
                )
            } else {
                $('#channelstats-title').html(
                    `
                        <div class="sinkhole"> Most Recommended Channels on&nbsp;<span class="redbold"> ` +
                    $('#date').val() + '</span>: ' + extra_text
                    + `</div>
                    `
                )
                $('#videostats-title').html(
                    `
                        <div class="sinkhole"> Most Recommended Videos: <div>
                    `
                )
            }
            console.log('Number of stuff')
            console.log(filtered_vids)
            filtered_vids.slice(0, 2000).forEach((elem, index) => {
                console.log('Elem')
                var item = videos_info[elem[0]];
                const views = item.views > 0 ? `${number_format(item.views)} views` : '';
                const multiplicator = item['nb_recommendations'];
                var indexplus = index + 1
                var nth = indexplus + 'th '
                if (indexplus === 1) {
                    nth = ''
                }
                if (indexplus === 2 ) {
                    nth = 'second '
                }
                if (indexplus === 3 ) {
                    nth = 'third '
                }
                const rightPanel = totalRecommendations ? `<div class="mult right" data-balloon-length="large" data-balloon="Out of the ${totalRecommendations} recommendations we observed that day, this video was recommended ${multiplicator} times."><div class="mult-x">${1 + Math.round(10000 * multiplicator / totalRecommendations)}</div><div class="mult-text">recommendations per 10k</div>`: `<div class="mult right" data-balloon-length="large" data-balloon="YouTube recommended this video from ${Math.round(multiplicator * 10) / 10} different channels"><div class="mult-text"> Number of channels recommending it: </div><div class="mult-x">${Math.round(multiplicator * 10) / 10} </div>`;
            //                <div class="mult right" data-balloon-length="large" data-balloon="YouTube recommended this video from ${Math.round(multiplicator * 10) / 10} different channels"><div class="mult-text"> Number of channels recommending it: </div><div class="mult-x">${Math.round(multiplicator * 10) / 10} </div>
                const mult = multiplicator ? `</div>` : '';

                const pDate = item.pDate ? ' published on ' + item.pDate : ''

                var from_chans_inner = '<br><br>'
                if ('from_chans' in item) {
                    from_chans_inner = item.from_chans.map(chan => 
                        '<strong>' + chan[0] + '</strong>: ' +
                        '<a target="_blank" href="https://www.youtube.com/watch?v=' + chan[1] +'">' + chan[2] + '</a>'
                    ).join('<br>')
                }

                var from_chans = `
                    <div style="margin-top:10px;font-size:12px;">YouTube recommended this video from at least <span class="nbchans"> ${Math.round(multiplicator * 10) / 10}</span> different channels
                `
                if ('from_chans' in item) {
                    from_chans += `
                        <a class="btn btn-primary see-recos" role="button" onclick="document.getElementById('collapse-reco-${index}').classList.toggle('collapse');">
                            See All
                        </a>
                    <div id="collapse-reco-${index}" class="collapse">
                        ${from_chans_inner}
                    </div>
                    `;
                }     
                from_chans += '</div>'

                // if ('from_chans' in item) {
                //     from_chans = ', including ' + item.from_chans.map(chan => '<a target="_blank" href="https://www.youtube.com/results?search_query=' + chan + '&sp=EgIQAg%253D%253D">' + chan + '</a>').join(', ') 
                // }

                if (item.views > 0 && multiplicator > 0) {
                    $('.sink-videos').append(
                        `
          <div class="box">
          <article class="media">
              <figure class="media-left level">
                <a href="https://www.youtube.com/watch?v=${item.id}" target="_blank">
                    <div class="is-inline-block level-item">
                      <img class="image" width="170px" src="https://img.youtube.com/vi/${item.id}/hqdefault.jpg">
                    </div>
                </a>
              </figure>
              <div class="media-content">
                <div class="content">
                    <a class="video-title" href="https://www.youtube.com/watch?v=${item.id}" target="_blank">${item.title}</a>
                    <div class="channel-title">${item.channel}</div>
                    <div><small class="video-stats">` +
                        views +
                        `<i class="fa fa-thumbs-up" aria-hidden="true" onclick="print_item('${item.id}')"></i>
                    ${number_format(item.likes)}
                    <i class="fa fa-thumbs-down" aria-hidden="true"></i>${number_format(item.dislikes)}${pDate}</small></div>
                    ${from_chans}
                </div>
              </div>
              </article>` +
                    rightPanel +
                        `</div>`
                    );
                }
            });
        }
        function hideIntro() {
            $('#intro').hide();
        }

        $(document).ready(function () {
            if (getUrlVar('keyword')) {
                $('#srch-term').val(getUrlVar('keyword'));
                $('#intro').hide();
                console.log('update date document ready')
                updateDate();
                console.log('update date document ready done')
                setTimeout(hideIntro, 100);
            }

            $('#srch-term').on('input', function (e) {
                appendSinkHoles();
            });

            // $.get("../data/*", function (data) {
            //     console.log('Initialize done');
            // });

            updateDate()
            var date_input = $('input[name="date"]'); //our date input has the name "date"
            var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
            var options = {
                format: 'mm/dd/yyyy',
                container: container,
                todayHighlight: true,
                startDate: '10-06-2018',
                autoclose: true,
            };
            date_input.datepicker(options).on('changeDate', function (event) {
                console.log('select')
                updateDate()
            });
        });
    </script>
</body>